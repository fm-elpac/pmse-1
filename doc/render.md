# pmse-render

忆苦引擎 渲染层.

目录:

TODO

## 1 渲染模式

3D 渲染模式 (render mode): `sr`, `pbr_ngi`, `pbr_gi_sv`, `pbr_gi_rt`.

从简单到复杂, 画质从低到高, 速度从快到慢.

- `sr` **简单光栅化渲染**: 直接从贴图 (纹理) 采样颜色输出, 不进行光照计算,
  无阴影.

  适合 纯漫反射, 静态 场景.

- `pbr_ngi` **基于物理的渲染**, 没有全局光照. 使用预先烘焙的光照贴图.

  适合 静态 场景.

- `pbr_gi_sv` **基于顶点的慢速全局光照渲染**: 不适合实时渲染, 用于烘焙 光照贴图
  (离线渲染).

- `pbr_gi_rt` **基于光线追踪的实时全局光照渲染**: "光追", 最高画质.

## 2 模型层次细节 (LOD) 和无缝大世界加载

- `lod_8s` 基于 8 叉树的简单层次细节模型: 单个模型 层次细节切换.

- `lod_8p` 基于 8 叉树的 分块 层次细节模型: 将单个模型 分块,
  每块单独处理层次细节 (弱化版 虚幻5).

---

空间块 边长: (空间缩放 LOD 层次细节)

- 宇宙坐标系: > 地球直径

- 地球坐标系: 1s (8km) ~ 12s (16Mm)

- 局域坐标系: 1d (4km) ~ 13d (1m)

基础空间块 边长: 4km (1d)

| 缩小空间块 (s) | 边长 (m) | 备注       |
| -------------: | -------: | :--------- |
|             1s |       8k |            |
|             2s |      16k |            |
|             3s |      32k |            |
|             4s |      64k |            |
|             5s |     128k |            |
|             6s |     256k |            |
|             7s |     512k |            |
|             8s |       1M |            |
|             9s |       2M |            |
|            10s |       4M |            |
|            11s |       8M |            |
|            12s |      16M | > 地球直径 |

地球坐标系, 更大: 宇宙坐标系 (太阳坐标系).

---

局域坐标系 (空间块):

| 细节空间块 (d) | 边长 (m) | 备注    |
| -------------: | -------: | :------ |
|             1d |       4k | (0s, 0) |
|             2d |       2k | (-1)    |
|             3d |       1k |         |
|             4d |      512 |         |
|             5d |      256 |         |
|             6d |      128 |         |
|             7d |       64 |         |
|             8d |       32 |         |
|             9d |       16 |         |
|            10d |        8 |         |
|            11d |        4 |         |
|            12d |        2 |         |
|            13d |        1 |         |

## 3 空间块和坐标系

TODO

- **近场坐标系** (局域坐标系): "活" 的世界范围, 默认 4km.
  不同物体有不同的近场距离设定 (8 叉树 交集).

  空间块 加载, 空间块 卸载.

  空块 加载优化: "没有内容" 的块.

  近场音效 (路径空间声音计算): 半径 100m (6d).

- **地表坐标系**: (海拔, 经纬度) 处理地球表面 (球面), 近似平面. 海拔范围: -16km
  ~ 32km.

  - 最深海沟 (海拔) 深度: -12km.

  - 大气层: 对流层 (18km), 平流层 (70km), 中间层 (高空对流层, 150km), 热层
    (电离层, 1000km), 散逸层.

  - 云层高度: 低云 (<2km, 积云 <2km, 积雨云 500m~10km, 层积云 <2km), 中云
    (2km~6km, 高积云, 高层云), 高云 (>6km, 卷云 6km~12km, 卷层云 5km~8km, 卷积云
    > 6km).

  - 飞机飞行高度: 客机 (8km~12km), 战斗机 (20km), 小型飞机 (3km~7km).

  - 人眼双目立体视觉 有效距离: 500~1000m.

- **地球坐标系**

  固定种子, 随机生成的 地形块 (LOD).

- **太阳坐标系**

---

- **空间块坐标系**: 每个空间块 (LOD) 都有自己的坐标原点 (在空间块中央). 各个物体
  (obj), 相对于 空间块坐标系 进行处理.

  禁止穿墙: 梯度实体场. 物体移动速度上限: 340m/s (不超声速).

- **摄像机坐标系**: 摄像机为原点 (透视前). 摄像机在原点不动, 大世界 (空间块)
  移动 (平移/旋转).

  虚拟 "大世界" 坐标系: 空间块坐标系 和 摄像机坐标系 (非透视) 之间的转换 (矩阵).

- **屏幕空间坐标系**: 透视后.

TODO
