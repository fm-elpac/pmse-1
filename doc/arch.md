# pmse-1 架构设计

忆苦引擎整体分为 4 个部分, 如图:

```
  +----------+     +----------+     +----------+
  |  控制层  | --> |  仿真层  | --> |  渲染层  |
  +----------+     +----------+     +----------+

  +--------------------------------------------+
  |                   基础层                   |
  +--------------------------------------------+
```

- **控制层** (思甜 `st`, 决策层): 进行整体状态/逻辑控制.

  - **程序控制** (`pmse-v8`): v8 (JS/WASM)

  - **AI (神经网络) 控制** (`pmse-ai`, AI / 程序混合控制)

- **仿真层** (忆苦 `pmse-se`, 物理引擎): rust/vulkan.

  - 3D 模型: 高精度解剖级建模 (结构功能).

  - (物理) **动力学** 仿真 (模拟) 计算: 高精度数值计算 (较慢), 低精度 AI 加速
    (近似) 计算.

    牛顿力学 (低精度模拟): 位置 (质量), 速度, 加速度 (力, 重力), **碰撞检测**.
    角度, 角速度, 角加速度, 动量, 角动量, 能量守恒, 动量守恒. 摩擦力, 弹性形变,
    流体力学 (空气动力学).

    仿真计算频率: 100Hz ~ 1kHz.

- **渲染层** (忆苦 `pmse-render`): 3D 渲染 (输出), rust/vulkan.

  - 基础渲染: LOD (分层模型细节), 无缝大世界.

  - 高级渲染: PBR (基于物理的渲染), 光线追踪 (全局光照).

  - 多媒体渲染: 文本 (字体), 图片 (png, jpg, svg, webp), 视频 (播放), 音频
    (播放), 网页 (嵌入浏览器, electronjs offline ?).

  - 显示 (创建) 窗口, 输入设备 (交互 IO), 显示器画面输出, VR (双目立体视觉,
    注视点渲染).

  - 空间声音渲染: 立体声/环绕声 输出.

  - 力反馈/温度/震动/触觉 输出.

  - (保留) 嗅觉/味觉 通道.

  - UI (用户界面) 系统: v8, vue/JS (fetch ?).

- **基础层** (忆苦 `pmse-yk`): 基础支持部分.

  - 数据 (资源) 加载系统: 打包文件格式, 磁盘加载优化, 热更新支持.

  - 状态存储系统 (`dbgit`): 暂停, 快照 (保存/加载, 自动快照).

    数据存储后端 (可更换): sqlite, PostgreSQL.

  - 操作系统 (平台) 接口 (适配代码).

  - **开发工具**: 场景编辑器 (blender 扩展), 打包输出优化, 调试工具
    (vscode/chromium).

## 主要技术

- 编程语言: rust, v8 (JS/TypeScript, WASM) (`rusty_v8`, deno)

- GPU API: vulkan (`vulkano`)

- 支持平台:

  - GNU/Linux (wayland) (`pmse-wayland`)
  - Windows (win32) (`pmse-win`)
  - Android (apk, vulkan/kotlin) (`pmse-apk`)

- AI 技术: `llama.cpp` (CPU/vulkan), GGUF.

- 分布式技术: 多进程, 多机分布运行, 前/后端分离.

## 多进程

- `pmse`: 主进程 (v8) (主要控制逻辑, 纯 CPU).

- `pmse-se`: 物理仿真引擎 (CPU/vulkan).

- `pmse-render`: 渲染进程 (显示窗口, vulkan, 处理 UI 交互/IO).

- AI 进程: 运行 AI 模型 (推理).

TODO
